<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ZTA - Dashboard</title>

<style>
    * { margin:0; padding:0; box-sizing:border-box; font-family:Arial; }
    body {
        background:url("assets/background.jpg") no-repeat center center fixed;
        background-size:cover;
        color:white;
        min-height:100vh;
    }

    .navbar {
        width:100%; padding:25px 60px;
        display:flex; justify-content:space-between; align-items:center;
        background:rgba(0,0,0,0.35); backdrop-filter:blur(10px);
        position:sticky; top:0; z-index:999;
    }

    nav a { margin-left:25px; color:#fff; text-decoration:none; font-size:17px; }
    nav a:hover { color:#ff5050; }

    .btn-login {
        padding:8px 18px; border:1px solid white; border-radius:6px;
    }
    .btn-login:hover { background:#ff5050; border-color:#ff5050; }

    .account-btn { display:none; margin-left:25px; cursor:pointer; }

    .dropdown {
        position:absolute; top:50px; right:0;
        width:160px; display:none; flex-direction:column;
        background:rgba(0,0,0,0.7); padding:10px 0; border-radius:8px;
    }
    .dropdown a { padding:10px 20px; color:white; }

    .center-box { margin-top:140px; text-align:center; }
    h1 { font-size:42px; text-shadow:0 0 15px black; }
    p { margin-top:10px; font-size:20px; opacity:0.8; }
</style>
</head>

<body>

<header class="navbar">
    <div class="logo">ZTA</div>

    <nav>
        <a href="index.html">About Me</a>
        <a href="gallery.html">Gallery</a>
        <a href="mission.html">Mission</a>
        <a href="shop.html">Gear</a>
        <a href="contact.html">Contact</a>

        <a id="loginBtn" class="btn-login" href="auth.html">Login</a>
        <span id="accountBtn" class="account-btn">Account ▼</span>

        <div id="dropdownMenu" class="dropdown">
            <a href="dashboard.html">Dashboard</a>
            <a href="profile.html">Profile</a>
            <a href="#" onclick="logout()">Logout</a>
        </div>
    </nav>
</header>

<section class="center-box">
    <h1>Welcome, <span id="usernameDisplay">User</span>!</h1>
    <p>Your journey begins here.</p>
</section>

<!-- FIREBASE -->
<script type="module">
import { auth, db } from "./firebase.js";

import {
    onAuthStateChanged,
    signOut
} from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

import {
    doc,
    getDoc
} from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

import { checkLoginStatus } from "./global.js";

/* ---------------------------
   CHECK USER LOGIN
---------------------------- */
onAuthStateChanged(auth, async (user) => {
    if (!user) {
        alert("Login required!");
        window.location.href = "auth.html";
        return;
    }

    // Fetch username from Firestore
    const ref = doc(db, "users", user.uid);
    const snap = await getDoc(ref);

    if (snap.exists()) {
        document.getElementById("usernameDisplay").innerText =
            snap.data().username || "User";
    } else {
        // fallback → show email prefix
        document.getElementById("usernameDisplay").innerText =
            user.email.split("@")[0];
    }

    checkLoginStatus();
});

/* ---------------------------
   LOGOUT
---------------------------- */
window.logout = function () {
    signOut(auth);
    localStorage.removeItem("zta_user");
    window.location.href = "auth.html";
};
</script>

</body>
</html>
